<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dreidel! üïé</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@300;400;700;900&family=Crimson+Pro:ital,wght@0,300;0,600;1,300&display=swap');

  :root {
    --gold:#C9A84C; --gold-light:#F0D080; --blue-deep:#0B1F3A;
    --blue-mid:#1A3A5C; --blue-bright:#2E6DB4; --cream:#F5EDD6;
    --red:#C0392B; --silver:#B8C9D9; --green:#27AE60;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background:var(--blue-deep); color:var(--cream);
    font-family:'Crimson Pro',Georgia,serif; min-height:100vh; overflow-x:hidden;
    background-image:
      radial-gradient(ellipse at 20% 50%,rgba(46,109,180,0.15) 0%,transparent 60%),
      radial-gradient(ellipse at 80% 20%,rgba(201,168,76,0.1) 0%,transparent 50%);
  }
  body::before {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
    background-image:
      radial-gradient(1px 1px at 10% 15%,rgba(255,255,255,0.5) 0%,transparent 100%),
      radial-gradient(1px 1px at 30% 45%,rgba(255,255,255,0.4) 0%,transparent 100%),
      radial-gradient(1px 1px at 55% 10%,rgba(255,255,255,0.5) 0%,transparent 100%),
      radial-gradient(1px 1px at 75% 60%,rgba(255,255,255,0.3) 0%,transparent 100%),
      radial-gradient(1px 1px at 90% 30%,rgba(255,255,255,0.5) 0%,transparent 100%),
      radial-gradient(1px 1px at 15% 80%,rgba(255,255,255,0.4) 0%,transparent 100%),
      radial-gradient(1px 1px at 60% 75%,rgba(255,255,255,0.3) 0%,transparent 100%),
      radial-gradient(1px 1px at 85% 85%,rgba(255,255,255,0.4) 0%,transparent 100%);
  }

  .container { position:relative; z-index:1; max-width:820px; margin:0 auto; padding:20px; }

  h1 {
    font-family:'Frank Ruhl Libre',serif; font-size:clamp(2rem,6vw,3.2rem); font-weight:900;
    text-align:center; color:var(--gold); letter-spacing:0.05em;
    text-shadow:0 0 40px rgba(201,168,76,0.4),0 2px 4px rgba(0,0,0,0.5); margin-bottom:4px;
  }
  .subtitle { text-align:center; color:var(--silver); font-style:italic; font-size:1rem; margin-bottom:24px; }

  .panel {
    background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.2);
    border-radius:12px; padding:20px 22px; backdrop-filter:blur(4px);
  }
  .panel h3 { font-family:'Frank Ruhl Libre',serif; font-size:1.1rem; color:var(--gold-light); margin-bottom:12px; }

  label { display:block; font-size:0.88rem; color:var(--silver); margin-bottom:4px; margin-top:10px; }
  input[type="text"], input[type="number"] {
    width:100%; background:rgba(255,255,255,0.06); border:1px solid rgba(201,168,76,0.3);
    color:var(--cream); padding:9px 12px; border-radius:8px;
    font-family:'Crimson Pro',serif; font-size:1rem; outline:none; transition:border-color 0.2s;
  }
  input:focus { border-color:var(--gold); }

  .screen { display:none; flex-direction:column; gap:18px; max-width:560px; margin:0 auto; }
  .screen.active { display:flex; }
  #screen-game, #screen-guess { max-width:820px; }

  /* Buttons */
  .btn-primary {
    background:linear-gradient(135deg,var(--gold),#A07830); color:var(--blue-deep);
    border:none; padding:12px 24px; border-radius:10px; font-family:'Frank Ruhl Libre',serif;
    font-size:1.1rem; font-weight:700; letter-spacing:0.06em; cursor:pointer; width:100%;
    transition:all 0.2s; box-shadow:0 4px 20px rgba(201,168,76,0.3);
  }
  .btn-primary:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 8px 30px rgba(201,168,76,0.4); }
  .btn-primary:disabled { opacity:0.4; cursor:not-allowed; }

  .btn-spin {
    background:linear-gradient(135deg,#2E6DB4,#1A3A5C); color:var(--cream);
    border:1px solid var(--blue-bright); padding:12px 24px; border-radius:10px;
    font-family:'Frank Ruhl Libre',serif; font-size:1.1rem; font-weight:700;
    letter-spacing:0.06em; cursor:pointer; width:100%; transition:all 0.2s;
    box-shadow:0 4px 20px rgba(46,109,180,0.3); margin-bottom:8px;
  }
  .btn-spin:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 8px 30px rgba(46,109,180,0.5); }
  .btn-spin:disabled { opacity:0.4; cursor:not-allowed; transform:none; }

  .btn-next {
    background:linear-gradient(135deg,var(--green),#1A5C30); color:var(--cream);
    border:none; padding:12px 24px; border-radius:10px; font-family:'Frank Ruhl Libre',serif;
    font-size:1.1rem; font-weight:700; letter-spacing:0.06em; cursor:pointer; width:100%;
    transition:all 0.2s; box-shadow:0 4px 20px rgba(39,174,96,0.3); margin-bottom:8px;
  }
  .btn-next:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 8px 30px rgba(39,174,96,0.5); }
  .btn-next:disabled { opacity:0.4; cursor:not-allowed; }

  .btn-secondary {
    background:transparent; color:var(--silver); border:1px solid rgba(255,255,255,0.15);
    padding:9px 20px; border-radius:8px; font-family:'Crimson Pro',serif;
    font-size:0.95rem; cursor:pointer; transition:all 0.2s; width:100%;
  }
  .btn-secondary:hover { border-color:var(--silver); color:var(--cream); }

  .btn-add {
    background:rgba(201,168,76,0.15); color:var(--gold); border:1px solid rgba(201,168,76,0.4);
    padding:9px 16px; border-radius:8px; font-family:'Frank Ruhl Libre',serif;
    font-size:1rem; cursor:pointer; transition:all 0.2s; white-space:nowrap;
  }
  .btn-add:hover { background:rgba(201,168,76,0.25); }
  .btn-icon { background:none; border:none; color:var(--red); cursor:pointer; font-size:1rem; padding:2px 6px; border-radius:4px; }

  /* Room code */
  .room-code-display {
    background:rgba(201,168,76,0.1); border:2px solid var(--gold);
    border-radius:12px; padding:16px; text-align:center;
  }
  .room-code-label { font-size:0.8rem; color:var(--gold); letter-spacing:0.1em; text-transform:uppercase; margin-bottom:4px; }
  .room-code-value { font-family:'Frank Ruhl Libre',serif; font-size:2.8rem; font-weight:900; color:var(--gold-light); letter-spacing:0.15em; }
  .room-link { font-size:0.78rem; color:var(--silver); margin-top:6px; word-break:break-all; }
  .copy-btn {
    background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15); color:var(--silver);
    padding:5px 12px; border-radius:6px; font-size:0.78rem; cursor:pointer; margin-top:6px; transition:all 0.2s;
  }
  .copy-btn:hover { border-color:var(--gold); color:var(--gold); }

  /* Online pips */
  .online-list { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
  .online-pip { background:rgba(39,174,96,0.15); border:1px solid rgba(39,174,96,0.4); border-radius:20px; padding:3px 10px; font-size:0.8rem; color:#90EE90; }
  .host-badge { background:rgba(201,168,76,0.2); border:1px solid rgba(201,168,76,0.4); border-radius:20px; padding:2px 8px; font-size:0.72rem; color:var(--gold); margin-left:4px; }

  /* Divider */
  .divider { display:flex; align-items:center; gap:12px; color:var(--silver); font-size:0.9rem; }
  .divider::before, .divider::after { content:''; flex:1; height:1px; background:rgba(255,255,255,0.1); }

  /* Mode toggles */
  .mode-pill { display:flex; border-radius:12px; border:1px solid rgba(201,168,76,0.3); overflow:hidden; }
  .mode-pill-btn {
    flex:1; padding:12px 8px; border:none; background:transparent; color:var(--silver);
    font-family:'Frank Ruhl Libre',serif; font-size:0.95rem; cursor:pointer; transition:all 0.2s;
    text-align:center; line-height:1.3;
  }
  .mode-pill-btn.active { background:rgba(201,168,76,0.2); color:var(--gold-light); }
  .mode-pill-divider { width:1px; background:rgba(201,168,76,0.3); }

  .variant-toggle { display:flex; gap:8px; }
  .variant-btn {
    flex:1; padding:11px; border:1px solid rgba(201,168,76,0.3); background:transparent;
    color:var(--silver); border-radius:8px; cursor:pointer; font-family:'Crimson Pro',serif;
    font-size:0.92rem; transition:all 0.2s; text-align:center;
  }
  .variant-btn.active { background:rgba(201,168,76,0.2); border-color:var(--gold); color:var(--gold-light); }

  /* Roster */
  .add-row { display:flex; gap:8px; }
  .add-row input { flex:1; }
  .roster-list { display:flex; flex-direction:column; gap:6px; margin-top:10px; }
  .roster-item { display:flex; align-items:center; gap:10px; background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.15); border-radius:8px; padding:8px 12px; }
  .roster-item span { flex:1; }

  /* Game header */
  .game-header {
    display:flex; justify-content:space-between; align-items:center;
    background:rgba(255,255,255,0.03); border:1px solid rgba(201,168,76,0.15);
    border-radius:10px; padding:10px 16px; font-size:0.88rem; color:var(--silver); flex-wrap:wrap; gap:8px;
  }
  .game-header strong { color:var(--gold); font-family:'Frank Ruhl Libre',serif; }

  /* Info bar */
  .info-bar {
    background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(201,168,76,0.05));
    border:1px solid rgba(201,168,76,0.4); border-radius:12px; padding:12px;
    display:flex; align-items:center; justify-content:center; gap:16px; flex-wrap:wrap;
  }
  .info-block { text-align:center; }
  .info-lbl { font-size:0.72rem; color:var(--gold); letter-spacing:0.1em; text-transform:uppercase; }
  .info-val { font-family:'Frank Ruhl Libre',serif; font-size:1.7rem; color:var(--gold-light); font-weight:900; }
  .info-div { width:1px; height:38px; background:rgba(201,168,76,0.3); }

  /* Scoreboard */
  .scoreboard { display:grid; gap:8px; }
  .player-card {
    background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.15);
    border-radius:10px; padding:10px 14px; display:flex; align-items:center; gap:12px; transition:all 0.35s;
  }
  .player-card.winner-flash { border-color:var(--gold); background:rgba(201,168,76,0.12); box-shadow:0 0 20px rgba(201,168,76,0.3); }
  .player-card.correct-guess { border-color:#90EE90; background:rgba(39,174,96,0.08); }
  .player-card.wrong-guess { border-color:var(--red); background:rgba(192,57,43,0.06); }
  .player-card.dimmed { opacity:0.3; }

  .d-icon { font-size:1.7rem; min-width:34px; text-align:center; display:inline-block; }
  @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
  .spinning .d-icon { animation:spin 0.25s linear infinite; }

  .p-info { flex:1; min-width:0; }
  .p-name { font-family:'Frank Ruhl Libre',serif; font-size:1rem; font-weight:700; }
  .p-result { font-size:0.8rem; color:var(--silver); font-style:italic; min-height:15px; }
  .p-result.gimmel { color:#FFD700; font-weight:600; font-style:normal; }
  .p-result.hey    { color:#90EE90; font-style:normal; }
  .p-result.nun    { color:var(--silver); }
  .p-result.shin   { color:var(--red); font-style:normal; }

  .p-scores { text-align:right; min-width:80px; }
  .p-wins { font-family:'Frank Ruhl Libre',serif; font-size:1.15rem; color:var(--gold); }
  .p-sub  { font-size:0.72rem; color:var(--silver); }
  .pos { color:#90EE90; } .neg { color:var(--red); } .zero { color:var(--silver); }

  .prog-wrap { background:rgba(255,255,255,0.05); border-radius:20px; height:4px; margin-top:4px; }
  .prog-bar  { height:100%; background:linear-gradient(90deg,var(--gold),var(--gold-light)); border-radius:20px; transition:width 0.5s ease; }

  .status-msg { text-align:center; font-style:italic; color:var(--gold-light); font-size:1rem; min-height:22px; }
  .tie-notice {
    text-align:center; background:rgba(201,168,76,0.1); border:1px solid rgba(201,168,76,0.3);
    border-radius:8px; padding:7px; font-style:italic; color:var(--gold-light); font-size:0.88rem; display:none;
  }

  /* Results banner */
  .results-banner {
    background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.3);
    border-radius:12px; padding:14px 18px;
  }
  .results-banner h4 { font-family:'Frank Ruhl Libre',serif; color:var(--gold-light); font-size:1rem; margin-bottom:10px; }
  .result-row { display:flex; align-items:center; gap:10px; padding:5px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
  .result-row:last-child { border-bottom:none; }
  .result-heb { font-size:1.5rem; min-width:32px; text-align:center; }
  .result-name { flex:1; font-size:0.95rem; }
  .result-badge { font-size:0.72rem; padding:2px 8px; border-radius:10px; font-family:'Frank Ruhl Libre',serif; }
  .badge-win     { background:rgba(201,168,76,0.2); color:var(--gold); border:1px solid rgba(201,168,76,0.4); }
  .badge-correct { background:rgba(39,174,96,0.2); color:#90EE90; border:1px solid rgba(39,174,96,0.4); }
  .badge-wrong   { background:rgba(192,57,43,0.15); color:#FFB3B3; border:1px solid rgba(192,57,43,0.3); }
  .result-letter.gimmel { color:#FFD700; }
  .result-letter.hey    { color:#90EE90; }
  .result-letter.nun    { color:var(--silver); }
  .result-letter.shin   { color:var(--red); }

  /* Guess mode */
  .guess-grid { display:flex; flex-direction:column; gap:8px; }
  .guess-player-row { background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.15); border-radius:10px; padding:10px 14px; }
  .guess-player-name { font-family:'Frank Ruhl Libre',serif; font-size:0.95rem; margin-bottom:8px; color:var(--cream); }
  .guess-btns { display:flex; gap:6px; }
  .guess-btn {
    flex:1; padding:8px 4px; border-radius:8px; border:1px solid rgba(201,168,76,0.25);
    background:rgba(255,255,255,0.04); cursor:pointer; text-align:center; transition:all 0.15s;
    font-family:'Frank Ruhl Libre',serif; font-size:1.1rem; color:var(--cream);
  }
  .guess-btn:hover:not(.locked) { border-color:var(--gold); background:rgba(201,168,76,0.1); }
  .guess-btn.selected { border-color:var(--gold-light); background:rgba(201,168,76,0.2); color:var(--gold-light); }
  .guess-btn.locked { cursor:default; opacity:0.6; }
  .guess-btn .g-heb  { display:block; font-size:1.3rem; }
  .guess-btn .g-name { display:block; font-size:0.58rem; color:var(--silver); margin-top:1px; }
  .guess-btn.selected .g-name { color:var(--gold); }

  /* Ledgers */
  .ledger-panel { border-radius:12px; padding:14px 16px; }
  .ledger-panel.ledger-round   { background:rgba(46,109,180,0.06); border:1px solid rgba(46,109,180,0.3); }
  .ledger-panel.ledger-session { background:rgba(201,168,76,0.05); border:1px solid rgba(201,168,76,0.25); }
  .ledger-panel h4 { font-family:'Frank Ruhl Libre',serif; font-size:0.85rem; letter-spacing:0.06em; text-transform:uppercase; margin-bottom:10px; }
  .ledger-round h4  { color:var(--blue-bright); }
  .ledger-session h4 { color:var(--gold); }
  .ledger-row { display:flex; align-items:center; gap:8px; padding:5px 0; border-bottom:1px solid rgba(255,255,255,0.04); }
  .ledger-row:last-child { border-bottom:none; }
  .ledger-name { flex:1; font-size:0.9rem; color:var(--cream); }
  .ledger-val  { font-family:'Frank Ruhl Libre',serif; font-size:1.05rem; font-weight:700; min-width:56px; text-align:right; }
  .ledger-bar-wrap { width:70px; height:5px; background:rgba(255,255,255,0.06); border-radius:4px; overflow:hidden; }
  .ledger-bar { height:100%; border-radius:4px; transition:width 0.5s ease; }
  .ledger-bar.up   { background:linear-gradient(90deg,#27AE60,#90EE90); }
  .ledger-bar.down { background:linear-gradient(90deg,var(--red),#FF8080); }
  .ledger-bar.blue { background:linear-gradient(90deg,var(--blue-bright),#90C8FF); }
  .ledger-two-col  { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

  /* Overlay */
  .overlay { display:none; position:fixed; inset:0; background:rgba(11,31,58,0.9); z-index:100; justify-content:center; align-items:center; backdrop-filter:blur(8px); }
  .overlay.show { display:flex; }
  .overlay-box {
    background:linear-gradient(135deg,rgba(201,168,76,0.12),rgba(46,109,180,0.08));
    border:2px solid var(--gold); border-radius:18px; padding:32px 36px;
    max-width:480px; width:90%; box-shadow:0 0 60px rgba(201,168,76,0.25);
    animation:pop 0.4s cubic-bezier(0.34,1.56,0.64,1); text-align:center;
  }
  @keyframes pop { from{transform:scale(0.6);opacity:0} to{transform:scale(1);opacity:1} }
  .ov-emoji  { font-size:3rem; margin-bottom:10px; }
  .ov-title  { font-family:'Frank Ruhl Libre',serif; font-size:2rem; color:var(--gold); margin-bottom:6px; }
  .ov-name   { font-family:'Frank Ruhl Libre',serif; font-size:1.6rem; color:var(--cream); margin-bottom:4px; }
  .ov-detail { color:var(--silver); font-style:italic; font-size:0.92rem; margin-bottom:18px; }
  .ov-actions { display:flex; flex-direction:column; gap:10px; }

  /* Hebrew legend */
  .heb-legend { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
  .hl { text-align:center; background:rgba(255,255,255,0.04); border:1px solid rgba(201,168,76,0.15); border-radius:8px; padding:6px 10px; min-width:62px; }
  .hl-h { font-size:1.4rem; display:block; }
  .hl-n { font-size:0.68rem; color:var(--gold); letter-spacing:0.05em; text-transform:uppercase; display:block; }
  .hl-r { font-size:0.65rem; color:var(--silver); font-style:italic; }

  .info-note { font-size:0.82rem; color:var(--silver); font-style:italic; text-align:center; }
  .host-only-note { font-size:0.82rem; color:var(--silver); font-style:italic; text-align:center; display:none; }
</style>
</head>
<body>
<div class="container">
  <h1>üïé Dreidel!</h1>
  <p class="subtitle">Chanukah's finest game of chance</p>

  <!-- ‚ïê‚ïê SCREEN: ENTRY ‚ïê‚ïê -->
  <div id="screen-entry" class="screen active">
    <div class="heb-legend">
      <div class="hl"><span class="hl-h">◊í</span><span class="hl-n">Gimmel</span><span class="hl-r">Best</span></div>
      <div class="hl"><span class="hl-h">◊î</span><span class="hl-n">Hey</span><span class="hl-r">2nd</span></div>
      <div class="hl"><span class="hl-h">◊†</span><span class="hl-n">Nun</span><span class="hl-r">3rd</span></div>
      <div class="hl"><span class="hl-h">◊©</span><span class="hl-n">Shin</span><span class="hl-r">Lowest</span></div>
    </div>
    <div class="panel">
      <h3>üë§ Your Name</h3>
      <input type="text" id="my-name" placeholder="Enter your name to play">
    </div>
    <button class="btn-primary" onclick="createRoom()">‚ú® Create New Game Room</button>
    <div class="divider">or join existing</div>
    <div class="panel">
      <h3>üîë Join a Room</h3>
      <input type="text" id="join-code" placeholder="e.g. XKCD" maxlength="6"
        style="text-transform:uppercase;letter-spacing:0.15em;font-size:1.3rem;text-align:center">
      <button class="btn-primary" style="margin-top:12px" onclick="joinRoom()">‚Üí Join Room</button>
    </div>
    <div id="entry-error" style="color:var(--red);text-align:center;font-style:italic;min-height:20px;"></div>
  </div>

  <!-- ‚ïê‚ïê SCREEN: LOBBY ‚ïê‚ïê -->
  <div id="screen-lobby" class="screen">
    <div class="room-code-display">
      <div class="room-code-label">üîó Room Code ‚Äî share with friends!</div>
      <div class="room-code-value" id="display-room-code">----</div>
      <div class="room-link" id="display-room-link"></div>
      <button class="copy-btn" onclick="copyLink()">üìã Copy shareable link</button>
    </div>

    <div class="panel">
      <h3>üåê Players Online</h3>
      <div class="online-list" id="online-list"></div>
    </div>

    <!-- Host-only setup -->
    <div id="host-setup" style="display:none;">
      <div class="panel">
        <h3>üéÆ Game Mode</h3>
        <div class="variant-toggle">
          <div class="variant-btn active" id="vbtn-classic" onclick="hostSetVariant('classic')">üïé Classic<br><span style="font-size:0.75rem;color:var(--silver);">Highest spin wins pot</span></div>
          <div class="variant-btn" id="vbtn-guess" onclick="hostSetVariant('guess')">üéØ Guess Mode<br><span style="font-size:0.75rem;color:var(--silver);">Predict the letter!</span></div>
        </div>
      </div>

      <div class="panel">
        <h3>üèÜ Win Condition</h3>
        <div class="mode-pill">
          <button class="mode-pill-btn active" id="mpbtn-rounds" onclick="hostSetWinMode('rounds')">üèÖ Best of Rounds<br><span style="font-size:0.78rem;">Most round wins</span></button>
          <div class="mode-pill-divider"></div>
          <button class="mode-pill-btn" id="mpbtn-points" oncli
